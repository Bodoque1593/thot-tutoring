@model Thot_projet.Models.Question
@{
    ViewBag.Title = "Détails de la question";

    var coursNom = (Model != null && Model.Ressource != null &&
                    Model.Ressource.ModuleCours != null &&
                    Model.Ressource.ModuleCours.Cours != null)
                   ? (Model.Ressource.ModuleCours.Cours.Nom ?? "--")
                   : "--";

    var resTitre = (Model != null && Model.Ressource != null)
                   ? (Model.Ressource.Titre ?? "Ressource")
                   : "Ressource";

    var routeId = ViewContext.RouteData.Values["id"] != null
        ? ViewContext.RouteData.Values["id"].ToString()
        : "";
}

<h2>Détails de la question</h2>

@if (TempData["ok"] != null)
{
    <div class="alert alert-success">@TempData["ok"]</div>
}
@if (TempData["err"] != null)
{
    <div class="alert alert-danger">@TempData["err"]</div>
}

<div class="panel panel-default">
    <div class="panel-heading">
        <strong>@coursNom</strong> · Ressource : @resTitre
        @if (Model != null && Model.EstResolvee)
        {
            <span class="label label-success" style="margin-left:8px;">Résolue</span>
        }
        else
        {
            <span class="label label-warning" style="margin-left:8px;">Ouverte</span>
        }
    </div>
    <div class="panel-body">
        <p>@(Model != null ? Model.Contenu : "")</p>
    </div>
</div>

<h3>Réponses</h3>
@{
    var reps = (Model != null && Model.Reponses != null)
        ? Model.Reponses
        : Enumerable.Empty<Thot_projet.Models.Reponse>();
}

@if (!reps.Any())
{
    <p>Aucune réponse pour l'instant.</p>
}
else
{
    <ul class="list-group">
        @foreach (var r in reps)
        {
            <li class="list-group-item">
                <div>@r.Contenu</div>
            </li>
        }
    </ul>
}

@if (Model != null && !Model.EstResolvee)
{
    <h3>Répondre</h3>
    using (Html.BeginForm("Answer", "Question", FormMethod.Post, new { @class = "form" }))
    {
        @Html.AntiForgeryToken()
        @Html.Hidden("id", routeId)

        <div class="form-group">
            @Html.TextArea("contenu", null, new { @class = "form-control", rows = 4, placeholder = "Écrire votre réponse..." })
        </div>

        <button type="submit" class="btn btn-success">Répondre</button>
        @Html.ActionLink("Retour", "Index", "Question", null, new { @class = "btn btn-default", style = "margin-left:8px;" })
    }
}
