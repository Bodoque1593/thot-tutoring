@model Thot_projet.Models.Question
@using System.Linq
@{
    ViewBag.Title = "Détails de la question";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var coursNom = (Model?.Ressource?.ModuleCours?.Cours?.Nom)
                   ?? (Model?.Cours?.Nom)
                   ?? "--";
    var resTitre = (Model?.Ressource?.Titre) ?? "Ressource";
}
<style>
    .page-head {
        margin-bottom: 16px;
    }

        .page-head h2 {
            margin: 0 0 6px;
        }

    .soft-hr {
        margin: 8px 0 16px;
    }
</style>

<div class="page-head">
    <h2>Détails de la question</h2>
    <hr class="soft-hr" />
</div>

@if (TempData["ok"] != null)
{<div class="alert alert-success">@TempData["ok"]</div>}
@if (TempData["err"] != null)
{<div class="alert alert-danger">@TempData["err"]</div>}

<div class="thot-card">
    <div class="panel panel-default" style="margin-bottom:0;border:0;background:transparent;">
        <div class="panel-heading" style="background:transparent;border-bottom:1px solid rgba(148,163,184,.4);color:#e5e7eb;">
            <strong>@coursNom</strong> · Ressource : @resTitre
            @if (Model?.EstResolvee == true)
            {<span class="label label-success" style="margin-left:8px;">Résolue</span> }
            else
            { <span class="label label-warning" style="margin-left:8px;">Ouverte</span>}
        </div>
        <div class="panel-body" style="background:transparent;color:#e5e7eb;">
            <p>@(Model?.Contenu ?? "")</p>
        </div>
    </div>
</div>

<h3>Réponses</h3>
@{
    var reps = Model?.Reponses ?? Enumerable.Empty<Thot_projet.Models.Reponse>();
}
@if (!reps.Any())
{
    <p><em>Aucune réponse pour l'instant.</em></p>
}
else
{
    <ul class="list-group">
        @foreach (var r in reps)
        {
            <li class="list-group-item">@r.Contenu</li>
        }
    </ul>
}

@if (Model != null && !Model.EstResolvee)
{
    <h3>Répondre</h3>
    using (Html.BeginForm("Answer", "Question", FormMethod.Post))
    {
        @Html.AntiForgeryToken()
        @Html.Hidden("id", Model.id)

        <textarea name="contenu" class="form-control thot-input" rows="3"
                  placeholder="Écrire votre réponse..."></textarea>

        <div class="checkbox" style="margin-top:8px">
            <label>
                <input type="checkbox" name="resoudre" checked />
                Marquer la question comme résolue
            </label>
        </div>

        <button type="submit" class="btn btn-thot-primary" style="margin-top:8px">Répondre</button>
        @Html.ActionLink(
            "Retour",
            "Index_Tuteur",
            "Question",
            null,
            new { @class = "btn btn-thot-ghost", style = "margin-top:8px;margin-left:8px" }
        )
    }
}
