@model IEnumerable<Thot_projet.Models.InscriptionBrowseVM>

@{
    ViewBag.Title = "S'inscrire à un cours";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="page-head">
    <h2>S'inscrire à un cours</h2>
    <small>Choisissez un cours et complétez votre inscription</small>
    <hr class="soft-hr" />
    <p class="thot-help">
        Cliquez sur « S’inscrire » pour un cours auquel vous n’êtes pas encore inscrit.
        Pour les cours payants, vous serez redirigé vers Stripe après l’inscription.
    </p>
</div>

@if (TempData["ok"] != null)
{
    <div class="alert alert-success">
        <span class="glyphicon glyphicon-ok-sign"></span> @TempData["ok"]
    </div>
}
@if (TempData["err"] != null)
{
    <div class="alert alert-danger">
        <span class="glyphicon glyphicon-exclamation-sign"></span> @TempData["err"]
    </div>
}

<div class="row">
    @foreach (var item in Model)
    {
        <div class="col-sm-6 col-md-4">
            <div class="thumbnail thot-course-card">
                <img src="@(string.IsNullOrWhiteSpace(item.ImageUrl)
                                ? "https://via.placeholder.com/640x360?text=Cours"
                                : item.ImageUrl)"
                     alt="@item.Nom"
                     style="max-height:180px;width:100%;object-fit:cover;" />

                <div class="caption">
                    <h4 class="thot-course-title" title="@item.Nom">@item.Nom</h4>
                    <p class="thot-course-meta">
                        <span class="thot-badge">Niveau @item.Niveau</span>
                    </p>

                    @if (!string.IsNullOrWhiteSpace(item.Description))
                    {
                        <p class="thot-help">@item.Description</p>
                    }

                    <p>
                        <span class="label label-info" style="font-size:12px;">
                            @item.Prix.ToString("0.00") $
                        </span>
                        @if (item.Prix > 0)
                        {
                            <span class="label label-warning" style="font-size:12px;margin-left:4px;">
                                Payant
                            </span>
                        }
                        else
                        {
                            <span class="label label-success" style="font-size:12px;margin-left:4px;">
                                Gratuit
                            </span>
                        }
                    </p>

                    @if (item.DejaInscrit)
                    {
                        <p><span class="label label-success">Déjà inscrit</span></p>
                    }
                    else
                    {
                        using (Html.BeginForm("Enroll", "Inscription", FormMethod.Post, new { @class = "inline-form" }))
                        {
                            @Html.AntiForgeryToken()
                            @Html.Hidden("coursId", item.CoursId)
                            <button type="submit" class="btn btn-thot-primary">
                                @if (item.Prix > 0)
                                {
                                    @:S’inscrire et payer
                                }
                                else
                                {
                                    @:S’inscrire
                                }
                            </button>
                        }
                    }
                </div>
            </div>
        </div>
    }
</div>
